<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>月別 時間割（カレンダービュー）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: system-ui, Meiryo, sans-serif; margin: 20px; background: #f7f7fb; }
  h1 { margin: 0 0 12px; font-size: 20px; }
  .toolbar { display: flex; gap: 10px; align-items: end; flex-wrap: wrap; margin-bottom: 12px; }
  select, button, input[type=number] {
    padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;
  }
  button { background: #2f6feb; color: #fff; border: none; cursor: pointer; }
  button:hover { filter: brightness(.95); }
  /* a もボタン見た目に */
  a.btn { display:inline-block; padding:8px 12px; border-radius:8px; background:#8e44ad; color:#fff; text-decoration:none; }
  a.btn:hover { filter: brightness(.95); }

  table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,.06); }
  th, td { border: 1px solid #eee; vertical-align: top; }
  th { background: #eef3ff; padding: 10px; text-align: center; font-size: 14px; }
  td { height: 120px; padding: 8px; font-size: 13px; }

  th:nth-child(6) { background: #e3f2fd; } /* 土 */
  th:nth-child(7) { background: #ffebee; } /* 日 */
  td:nth-child(6) { background: #f8fbff; }
  td:nth-child(7) { background: #fff8f8; }

  .day-num { font-weight: 700; color: #333; margin-bottom: 6px; }
  .lesson { margin: 2px 0; }
  .tag { display: inline-block; background: #f1f5ff; color: #345; border: 1px solid #dfe8ff; border-radius: 6px; padding: 2px 6px; font-size: 12px; }
  .muted { color: #888; }
  .note { color: #666; font-size: 12px; margin-top: 8px; }

  /* ツールバー右寄せのボタン置き場 */
  .grow { flex: 1 }
</style>
</head>
<body>

<h1>月別 時間割（{{ selected_year }}年 {{ selected_month }}月）</h1>

<div class="toolbar">
  <form method="get" action="{{ url_for('tukijikanwari') }}" style="display:flex; gap:10px; align-items:end; flex-wrap:wrap;">
    <div>
      <label>年</label><br>
      <input type="number" name="year" value="{{ selected_year }}" min="2000" max="2100">
    </div>
    <div>
      <label>月</label><br>
      <select name="month" id="month">
        {% for m in range(1,13) %}
          <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}月</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <button type="submit">表示</button>
    </div>
  </form>
  <div class="grow"></div>
  <!-- 追加：CSVダウンロード -->
  <a class="btn" href="{{ url_for('tukijikanwari_csv', year=selected_year, month=selected_month) }}">CSVダウンロード</a>
  <!-- 追加：授業科目編集へ -->
  <a class="btn" href="{{ url_for('kamoku_edit') }}">授業科目を追加</a>
</div>

<table>
  <thead>
    <tr>
      {% for label in youbi_labels %}
        <th>{{ label }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for week in month_weeks %}
      <tr>
        {% for day in week %}
          {% if day == 0 %}
            <td class="muted"><div class="day-num"> </div></td>
          {% else %}
            <td>
              <div class="day-num">{{ day }}</div>
              {% set lessons = days_map.get(day, []) %}
              {% if lessons %}
                {% for les in lessons|sort(attribute='時限') %}
                  <div class="lesson">
                    <span class="tag">{{ les['時限'] }}限</span>
                    <a href="{{ url_for('kamoku_edit_day', year=selected_year, month=selected_month, day=day, period=les['時限']) }}"
                       style="color:#2f6feb; text-decoration:none;">
                      {{ les['科目名'] }}
                    </a>
                    {% if les['教室ID'] %}（{{ les['教室ID'] }}）{% endif %}
                  </div>
                {% endfor %}
              {% else %}
                <div class="muted">予定なし</div>
              {% endif %}
            </td>
          {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>

<div class="note">※ 授業は「授業計画 × 週時間割」の一致から作成。空欄はその日の登録がないことを意味します。</div>

</body>
</html>